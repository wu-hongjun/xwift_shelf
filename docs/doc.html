<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Xwift Shelf Documentation - Auto Maya Dev Pipeline</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="scribbler-global.css">
    <link rel="stylesheet" href="scribbler-doc.css">
    <link rel="author" href="http://hongjunwu.com">
  </head>
  <body>
    <div class="doc__bg"></div>
    <nav class="header">
      <h1 class="logo">Xwift <span class="logo__thin">Doc</span></h1>
      <ul class="menu">
        <div class="menu__item toggle"><span></span></div>
        <li class="menu__item"><a href="https://github.com/wu-hongjun/xwift_shelf" class="link link--dark"><i class="fa fa-github"></i> Github</a></li>
        <li class="menu__item"><a href="index.html" class="link link--dark"><i class="fa fa-home"></i> Home</a></li>
      </ul>
    </nav>
    <div class="wrapper">
      <aside class="doc__nav">
        <ul>
          <li class="js-btn selected">Introduction</li>
          <li class="js-btn">Get Started</li>
          <li class="js-btn">Advanced Usage</li>
          <li class="js-btn">Heiya Functions</li>
          <li class="js-btn">To-Do</li>
          <li class="js-btn">License</li>
        </ul>
      </aside>
      <article class="doc__content">
        <section class="js-section">
          <h2 class="section__title">Chapter 1: Introduction</h2>
          <p>
            Note: This documentation is still work in progress. Only Chapter 1 is done.
          </p>
          <p>
            Developing scripts for Maya is equally confusing and complicated.
            Therefore, I developed the Xwift pipeline to make developing for Maya fast and easy.
            I believe a lot of people will benefit from Xwift shelf to build and organize their toolkits, life is simply many, many times easier.
          </p>
          <h3>1.0 - Background Story (Optional)</h3>
            <p>
              The guy who led me into the craft of tech art once said:
              "One does not seek tech art for a career,
              tech art selects its followers."
              That is, Technical Art is very much like witchcraft,
              everyone finds their own way here, mostly by searching and a lot of trial & error.
            </p>
            <p>
              I started to develop my own tools when I was producing my animated short, "Dazzle!", at University of Washington's Animation Research Labs.
              It initially started as making small fixes to continue the animation production during pandemic, because many things break when using them remotely.
              As time grows, I have a handful collection of tools I developed, and I needed a way to organize them.
            </p>
            <p>
              I started developing an automatic deployment and reload script by a lot of googling, and started to build my own shelf to host all my tools.
              I improved my implementation of Xwift shelf from some blog posts I could find online, and had all my tools organized in one place.
            </p>
            <p>
              Xwift shelf is not my entire toolkit, as my tools remain private at the moment.
              Instead, it is a good backbone that anyone can build and organize their tools upon, and should make a lot of people very happy.
            </p>
          <h3>1.1 - What's Xwift Shelf?</h3>
          <p>
            In short, I am providing you with three things:
            <li>A flexible and comprehensive Maya shelf system written in Python 3.</li>
            <li>Advanced Maya script development and deployment pipeline with auto reload.</li>
            <li>To demonstrate how to embed your own tools into Xwift shelf, I also added an asset manager which can be useful for many purposes as a bonus.</li>
          </p>
          <p>
            Basically, it is a much, much more painless way to develop for Maya.
          </p>
          <h3>1.2 - The Old Workflow</h3>
            <p>
              In this section, I will briefly talk about the old workflow to develop scripts in Maya.
              If you are familiar with the traditional Maya development workflow, feel free to skip this section as well.
              However, it should be very useful for anyone who is interested in how Maya scripts work.
            </p>
            <p>
              Running Python scripts in Maya is simple, you write some code in the script editor, and you run that script, and it should work.
              It sounds easy, until you start to do any serious tool that is more complicated than generate random cubes.
            </p>
            <p>
              In my opinion, there are several downsides for developing Python scripts directly inside Maya's Script Editor:
              <li>You don't get any modern help from IDEs in the script editor such as code highlighting, auto-complete, error correction, etc.</li>
              <li>Script Editor does not give you a clear idea of file hierarchy of your project.</li>
              <li>Code developed in the script editor is usually not version controlled, and you need to manually copy and push to Git repository.</li>
            </p>
          <h3>1.3 The (Slightly) Better Way</h3>
            <p>
              I can go on and on, and the idea is it is just not a good idea to develop in the Script Editor.
              In fact, based on my industry experience, people don't do this as well,
              studios usually develop their code in Pycharm and pass the code to Maya using a plug-in called Mayacharm.
            </p>
            <p>
              Pycharm is probably the most powerful Python IDE on the market, and their community version is free to use.
              Using the free Mayacharm plug-in, it automatically sends the code you wrote in Python to Maya's Script Editor, and run it.
              That is how most people nowadays develop their script for Maya.
              You can think of it as a better script editor, but the workflow is still more or less the same.
            </p>
          <h3>1.4 The Problem</h3>
            <p>
              However, I find this solution far from perfect.
              <li>
                First, your scripts still need to be located in Maya's MAYA_SCRIPT_PATH
                (That is, something like <code>C:\Users\hongj\Documents\maya\2023\scripts</code> that is difficult to find)
                if you want to import functions in other scripts.
                There is no way to easily just develop in a Git repository and run code from there.
              </li>
              <li>
                Second, once you made any changes to your script, Maya does not automatically reload.
                You need to manually run a <code>reload(YOUR_SCRIPT)</code> command each time you made any changes in your code,
                otherwise Maya will not use the updated script.
              </li>
            </p>
            <p>
              Xwift Shelf was developed to solve these two problems which creates the most redundant and unnecessary work during development.
              You can develop your scripts in a repository, and once you run it, everything just works as it intends to be.
              In the next section, I will introduce you to the new workflow.
            </p>

          <h3>1.6 The Xwift Workflow</h3>
            <p>
              I have no intent to completely revolutionize everything, the Xwift pipeline builds on the PyCharm+Mayacharm workflow, just making it easier.
              <li>
                You still write code in PyCharm and use the MayaCharm plug-in to send code to Maya.
              </li>
              <li>
                You now save all your scripts inside a Git repository (Similar to the <code>xwift_shelf</code> repository) instead of MAYA_SCRIPT_PATH.
              </li>
              <li>
                When you want to call a function, you call it directly from <code>playground.py</code> and press <code>Alt+A</code>, which is faster than mapping the function to a button.
              </li>
              <li>
                You no longer need to manually run <code>reload(YOUR_SCRIPT)</code> when you make any changes, your codebase is automatically refreshed when you send your code out from the <code>playground.py</code>.
              </li>
            </p>

          <h3>1.6 How does it work???</h3>
            <p>
              If you read through section 1.2 to 1.6, you might find the Xwift workflow deceptively simple and too good to be true.
              I will briefly explain how it works.
            </p>
            <li>
              First, we are not actually running code directly from your repository.
              Xwift has a mechanism called <code>reload_util.py</code> which automatically copies and pastes the code repository into MAYA_SCRIPT_PATH.
            </li>
            <li>
              Then, it will automatically reload all the scripts inside the copied codebase in MAYA_SCRIPT_PATH.
            </li>
            <li>
              Once that is done, it executes whatever you want to run, and Maya uses the most up-to-date code.
            </li>
            <p>
              Essentially, it is doing the boring work in the background automatically,
              and because computer does this so fast, it looks like you are running your code from the repository.
            </p>
            <p>
              Below is an example <code>playground.py</code>, and at this point, you should have a rough idea of what <code>reload_util</code> is doing.
            </p>
            <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code class="language-python">
                import reload_util

                REPO_PATH = "C:/Users/hongj/PycharmProjects/xwift_shelf/xwift"
                reload_util.reload_from_playground(REPO_PATH)


                # =============== Run your code below =============

                # Here is an example to run the asset library UI.
                # from asset_lib import library_ui
                # ui = library_ui.showUI()
              </code>
            </pre>
          </div>
        </section>

        <section class="js-section">
          <h2 class="section__title">Chapter 2: Get Started</h2>
          <p>
            In this section, I will walk you through how to setup <code>xwift_shelf</code>.
          </p>
          <p>
            Note: This looks long because is a babysit tutorial that covers in great detail. Once you get it, it is brainless to run.
          </p>
          <h2>2.1 - Gather Resources</h2>
          <p>
            Before everything, let's install some prerequisites. I will show you how to install PyCharm and Mayacharm.
          </p>
          <p>
            To install PyCharm, simply head over to the <a href="https://www.jetbrains.com/pycharm/download/">Pycharm Official Website</a>
            and download the Pycharm Community version.
            You can of course use PyCharm Professional, but as a PyCharm Professional user myself,
            I can say it does not add any benefit to Maya development except maybe you have some money to throw into the water.
            Just use the PyCharm Community.
          </p>
          <img src="./img/pycharm_download.png" width="100%" height="100%">
          <p>
            Then, head over to <a href="https://plugins.jetbrains.com/plugin/8218-mayacharm/versions">Jetbrains Marketplace for Mayacharm</a> and download the newest version of MayaCharm.
          </p>
          <img src="./img/mayacharm_download.png" width="100%" height="100%">
          <p>
            Install Mayacharm using the official guide, which I provided a screenshot below.
          </p>
          <img src="./img/mayacharm_install.png" width="100%" height="100%">
          <p>
            Head over to PyCharm, and on the menu bar,
            <code>File -> Settings</code> and follow the screenshots below to configure where your <code>mayapy.exe</code> is located.
            If you installed in the default location it is more or less located in somewhere like <code>C:\Program Files\Autodesk\Maya2023\bin\mayapy.exe</code>.
          </p>
          <img src="./img/search_interpreter.png" width="100%" height="100%">
          <img src="./img/add_interpreter.png" width="100%" height="100%">
          <p>
            Now, head over to Pycharm menubar <code>File -> Settings -> MayaCharm</code> and configure the active Maya SDK to the <code>mayapy</code> you setup in last step, and port to 4434 as shown below.
          </p>
          <img src="./img/mayacharm_settings.png" width="100%" height="100%">
          <p>To test whether you have your Mayacharm setup well, do the following:</p>
          <li>Make sure PyCharm and Maya are both open and running.</li>
          <li>Using Pycharm's toolbar, <code>File -> New -> Python File</code> to make a new script.</li>
          <li>Copy the code below and paste it into the newly created script, save it, and press <code>Alt+A</code>.</li>
          <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code class="language-python">
                import maya.cmds as cmds

                # Set MayaCharm Port
                if not cmds.commandPort(':4434', q=True):
                &nbsp;   cmds.commandPort(n=':4434')

                # Make a cube!
                cmds.polyCube()
              </code>
            </pre>
          </div>
          <p>A new cube will be created in the empty Maya scene. Your Mayacharm is fully set!</p>
          <img src="./img/new_cube.png" width="100%" height="100%">
          <h2>2.2 - Make the Tool</h2>
          <p>
            Copy all the code and paste them into your newly created notebook. This code is also available on Github in <a href="https://github.com/wu-hongjun/heiya/blob/main/jpg_hei.ipynb">jpg_hei.ipynb (Link)</a>. 
          </p>
          <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code class="language-python">
                """
                JPG to HEIF/AVIF
                Convert JPG shoot by camera to High Efficiency Images with metadata to import to iCloud photo library.

                import heiya
                import pyperclip as clip

                # Custom file path override, usually just leave it blank if you use pyperclip
                source_dir = ""

                # Get the image location directly from the clipboard
                if source_dir == "":
                    source_dir = clip.paste()
                    
                # This will convert all the JPG in source_dir to HEI.
                # source_format = 0 -> JPG. (You don't need to change this for most of the time, you can also set to 1 for PNG.)
                # target_format = 0 -> AVIF (For smaller file size but less compatible, requires iOS 16/macOS Ventura or higher).
                # target_format = 1 -> HEIF (For best compatibility but slightly larger file size, requires additional extension to open on Windows).
                heiya.to_hei.convert_image_in_dir_to_hei(source_dir, source_format=0, target_format=1)
              </code>
            </pre>
          </div>
          <p>Your notebook should already be saved, if not, do a quick "File - Save As" on the Notebook tool bar to make sure your notebook is created.</p>
          <h2>2.3 - Run the Code</h2>
          <p>Now, use Finder(macOS)/File Explorer(Windows) to go to the place where you store all of the JPGs you desire to convert.</p>
          
          <h3>2.3.1 - Copy the directory address.</h3>
          <p>Copy the directory address to your clipboard.</p>
          <li>
            Windows: File Explorer -> Go to your target folder -> Single Click address bar -> Copy the file path in address bar.
          </li>
          <li>
            macOS: Finder -> Go to your target folder -> Hold Alt (File path should apper in bottom left) -> Right click on folder and copy file path.
          </li>
          <p>
            At this point, you might have something similar to this example stored in your clipboard. 
            This is a SD card from a Fujifilm camera, your address might vary depending on where your photos are.
          </p>
          <div class="code__block code__block--notabs">
            <pre class="code code--block">
              <code>
                D:\DCIM\207_FUJI  (Windows)
                /Volumes/SDXC/DCIM/207_FUJI  (macOS)
              </code>
            </pre>
          </div>

          <p>Now, you can do one of two things:</p>
          <li>
            If you just want to use the directory in your clipboard, do nothing.
          </li>
          <li>
            If you wish to enter a custom path, paste the address into <code>source_dir</code>.
          </li>
          
          <h3>2.3.2 -  Run the code.</h3>
          <p>Make sure to select the cell by single clicking the code.</p>
          <p>Navigate to your tool bar, and "Cells - Run Cells" to run the newly copied code. </p>
          <p>Additionally, you can use <strong>Shift + Enter</strong> on your keyboard to make this operation faster.</p>
          <p>Heiya should automatically start to convert the JPGs, and will print the progress down below.</p>
          <img src="./img/pyperclip_convert_finished.png" width="100%" height="100%">
          <p>Horray! Now just drag all the HEIF/AVIF files into Apple Photos/Google Photos and enjoy amazing photos that takes up very little storage!</p>
          <h2>2.4 - Conclusion</h2>
          <p>In this section, I hope I did a fair job detailing basic usage of this tool and accounted for any obstacles you might encounter using it.</p>
          <p>From now on, all you need to do is open the tool in Jupyter notebook, copy the folder path, and run the code. Should be pretty brainless.</p>
          <p>If you have any question, feel free to contact me by going to <a href="https://i.hongjunwu.com/contact/">my contact page (Link)</a>.</p>
      
        <section class="js-section">
          <h3 class="section__title">Chapter 3: Advanced Usage</h3>
          <p>For now, I have limited time and effort, so any advanced usage and how to use other functions of Heiya can be found in the following notebooks.</p>
          <table id="customers">
            <tr>
              <th>Name</th>
              <th>Link</th>
            </tr>
            <tr>
              <td>Heiya Basic Demo</td>
              <td><a href="https://github.com/wu-hongjun/heiya/blob/main/heiya_basic_demo.ipynb">https://github.com/wu-hongjun/heiya/blob/main/heiya_basic_demo.ipynb</a></td>
            </tr>
            <tr>
              <td>Heiya Full Demo</td>
              <td><a href="https://github.com/wu-hongjun/heiya/blob/main/heiya_full_demo.ipynb">https://github.com/wu-hongjun/heiya/blob/main/heiya_full_demo.ipynb</a></td>
            </tr>
          </table>
          <hr />
        </section>

        <section class="js-section">
          <h3 class="section__title">Chapter 4: Heiya Functions</h3>
          <p>This chapter will be the home to document all the functions available to call independently so you can build your own pipeline.</p>
          <p>It is work in progress, and most information you are looking for can be found in the <strong>Advanced Usage</strong> section above.</p>
          <hr />
        </section>
        
        <section class="js-section">
          <h3 class="section__title">Chapter 5: To-Do</h3>
          <p>Some potential improvements that can be done include:</p>
          <li>
            Currently Heiya only supports converting to 8-bit (Which is mostly enough, since JPG can do at most 8 bit). 
            However, enabling Conversion to 10bit(HEIF) or 12bit(AVIF) is a welcomed improvement.
          </li>
          <li>
            One potential solution to enable higher bitrate is to deprecate <code>pillow_heif</code> and instead rewrite the entire tool using <code>imagemagick</code>. 
            Although I shall note that if you have a camera that already shoots HEIF, you probably don't need this tool.
          </li>
          <li>
            Some additional video encoding capabilities is under active development by wrapping <code>ffmpeg</code>.
          </li>
          <li>
            Of course, a Heiya GUI would be nice.
          </li>
          <li>
            An automatic deployment of the tool might be a welcomed addition too.
          </li>
          <hr />
        </section>

        <section class="js-section">
          <h3 class="section__title">Chapter 6: License</h3>
          <p>Heiya is distributed in the license in <a href="https://github.com/wu-hongjun/heiya/blob/main/LICENSE.txt">LICENSE.txt</a>.</p>
          <hr />
        </section>
      </article>
    </div>

    <footer class="footer">Copyright <a href="https://hongjunwu.com" target="_blank" class="link link--light">Hongjun Wu</a>, all rights reserved, 2022.</footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
    <!-- <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script> -->
    
    <script>hljs.initHighlightingOnLoad();</script>
    <script>hljs.highlightAll();</script>

    <script src="scribbler.js"></script>
  </body>
</html>